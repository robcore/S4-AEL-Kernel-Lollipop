From 98abf5d101f7f6a9705f911a2361cd14a28a12c2 Mon Sep 17 00:00:00 2001
From: friedrich420 <kelpidorou@yahoo.com>
Date: Sun, 7 Feb 2016 12:38:57 +0200
Subject: [PATCH] bcmdhd: reduce rx wakelock timeout via sysfs node [halaszk]

---
 drivers/net/wireless/bcmdhd4358/dhd_linux.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/drivers/net/wireless/bcmdhd4358/dhd_linux.c b/drivers/net/wireless/bcmdhd4358/dhd_linux.c
index 3886ee0..69d4b28 100755
--- a/drivers/net/wireless/bcmdhd4358/dhd_linux.c
+++ b/drivers/net/wireless/bcmdhd4358/dhd_linux.c
@@ -163,6 +163,11 @@ extern bool ap_fw_loaded;
 
 #include <wl_android.h>
 
+#include <linux/moduleparam.h>
+
+static int wl_divide = 1;
+module_param(wl_divide, int, 0644);
+
 /* Maximum STA per radio */
 #define DHD_MAX_STA     32
 
@@ -9132,10 +9137,10 @@ int dhd_os_wake_lock_timeout(dhd_pub_t *pub)
 #ifdef CONFIG_HAS_WAKELOCK
 		if (dhd->wakelock_rx_timeout_enable)
 			wake_lock_timeout(&dhd->wl_rxwake,
-				msecs_to_jiffies(dhd->wakelock_rx_timeout_enable));
+				msecs_to_jiffies(dhd->wakelock_rx_timeout_enable)/wl_divide);
 		if (dhd->wakelock_ctrl_timeout_enable)
 			wake_lock_timeout(&dhd->wl_ctrlwake,
-				msecs_to_jiffies(dhd->wakelock_ctrl_timeout_enable));
+				msecs_to_jiffies(dhd->wakelock_ctrl_timeout_enable)/wl_divide);
 #endif
 		dhd->wakelock_rx_timeout_enable = 0;
 		dhd->wakelock_ctrl_timeout_enable = 0;
