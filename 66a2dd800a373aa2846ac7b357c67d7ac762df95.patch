From 66a2dd800a373aa2846ac7b357c67d7ac762df95 Mon Sep 17 00:00:00 2001
From: HolyAngel <slverwolf@gmail.com>
Date: Sun, 8 Feb 2015 17:55:03 -0800
Subject: [PATCH] -O3 All the things

Conflicts:
	arch/arm/vfp/Makefile
	drivers/thermal/Kconfig
---
 arch/arm/boot/Makefile       | 2 ++
 arch/arm/common/Makefile     | 2 ++
 arch/arm/kernel/Makefile     | 2 ++
 arch/arm/lib/Makefile        | 2 ++
 arch/arm/mach-msm/Makefile   | 2 ++
 arch/arm/mm/Makefile         | 2 ++
 arch/arm/vfp/Makefile        | 3 ++-
 block/Makefile               | 2 ++
 crypto/Makefile              | 2 ++
 drivers/char/Makefile        | 2 ++
 drivers/clocksource/Makefile | 2 ++
 drivers/cpufreq/Makefile     | 2 ++
 drivers/cpuidle/Makefile     | 2 ++
 drivers/i2c/Makefile         | 2 ++
 drivers/input/Makefile       | 2 ++
 drivers/staging/Makefile     | 2 ++
 drivers/thermal/Kconfig      | 1 -
 drivers/tty/Makefile         | 2 ++
 drivers/watchdog/Makefile    | 2 ++
 firmware/Makefile            | 2 ++
 fs/Makefile                  | 2 ++
 init/Makefile                | 2 ++
 ipc/Makefile                 | 2 ++
 lib/Makefile                 | 2 ++
 mm/Makefile                  | 2 ++
 samples/Makefile             | 2 ++
 scripts/Makefile             | 2 ++
 security/Makefile            | 2 ++
 usr/Makefile                 | 2 ++
 29 files changed, 56 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/Makefile b/arch/arm/boot/Makefile
index 1fbf215..95ab149 100644
--- a/arch/arm/boot/Makefile
+++ b/arch/arm/boot/Makefile
@@ -11,6 +11,8 @@
 # Copyright (C) 1995-2002 Russell King
 #
 
+KBUILD_CFLAGS	+=-O3
+
 ifneq ($(MACHINE),)
 include $(srctree)/$(MACHINE)/Makefile.boot
 endif
diff --git a/arch/arm/common/Makefile b/arch/arm/common/Makefile
index 6c24dce..71c0cdb 100644
--- a/arch/arm/common/Makefile
+++ b/arch/arm/common/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the linux kernel.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-$(CONFIG_ARM_GIC)		+= gic.o
 obj-$(CONFIG_ARM_VIC)		+= vic.o
 obj-$(CONFIG_ICST)		+= icst.o
diff --git a/arch/arm/kernel/Makefile b/arch/arm/kernel/Makefile
index fc00a23..272130b 100644
--- a/arch/arm/kernel/Makefile
+++ b/arch/arm/kernel/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the linux kernel.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 CPPFLAGS_vmlinux.lds := -DTEXT_OFFSET=$(TEXT_OFFSET)
 AFLAGS_head.o        := -DTEXT_OFFSET=$(TEXT_OFFSET)
 
diff --git a/arch/arm/lib/Makefile b/arch/arm/lib/Makefile
index 64d5a64..bbb418d 100644
--- a/arch/arm/lib/Makefile
+++ b/arch/arm/lib/Makefile
@@ -4,6 +4,8 @@
 # Copyright (C) 1995-2000 Russell King
 #
 
+KBUILD_CFLAGS	+=-O3
+
 lib-y		:= backtrace.o changebit.o csumipv6.o csumpartial.o   \
 		   csumpartialcopy.o csumpartialcopyuser.o clearbit.o \
 		   delay.o delay-loop.o findbit.o memchr.o memcpy.o   \
diff --git a/arch/arm/mach-msm/Makefile b/arch/arm/mach-msm/Makefile
index 43e207c..b34bf11 100755
--- a/arch/arm/mach-msm/Makefile
+++ b/arch/arm/mach-msm/Makefile
@@ -1,5 +1,7 @@
 CFLAGS_scm.o :=$(call as-instr,.arch_extension sec,-DREQUIRES_SEC=1)
 
+KBUILD_CFLAGS	+=-O3
+
 obj-y += io.o dma.o memory.o
 ifndef CONFIG_ARM_ARCH_TIMER
 obj-y += timer.o
diff --git a/arch/arm/mm/Makefile b/arch/arm/mm/Makefile
index 068d46e..a53a13c 100644
--- a/arch/arm/mm/Makefile
+++ b/arch/arm/mm/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the linux arm-specific parts of the memory manager.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-y				:= dma-mapping.o extable.o fault.o init.o \
 				   iomap.o
 
diff --git a/arch/arm/vfp/Makefile b/arch/arm/vfp/Makefile
index ed39d56..4d2fa0a 100644
--- a/arch/arm/vfp/Makefile
+++ b/arch/arm/vfp/Makefile
@@ -7,7 +7,8 @@
 # ccflags-y := -DDEBUG
 # asflags-y := -DDEBUG
 
-KBUILD_AFLAGS	:=$(KBUILD_AFLAGS:-mhard-float=-Wa,-mfpu=neon-vfpv4 -mfloat-abi=hard)
+BUILD_AFLAGS	:=$(KBUILD_AFLAGS:-mhard-float=-Wa,-mfpu=neon-vfpv4 -mfloat-abi=hard)
+KBUILD_CFLAGS	+=-O3
 LDFLAGS		+=--no-warn-mismatch
 
 obj-y			+= vfp.o
diff --git a/block/Makefile b/block/Makefile
index ab1be8b..92aacda 100644
--- a/block/Makefile
+++ b/block/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the kernel block layer
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-$(CONFIG_BLOCK) := elevator.o blk-core.o blk-tag.o blk-sysfs.o \
 			blk-flush.o blk-settings.o blk-ioc.o blk-map.o \
 			blk-exec.o blk-merge.o blk-softirq.o blk-timeout.o \
diff --git a/crypto/Makefile b/crypto/Makefile
index 012ffa7..3ec53cb 100644
--- a/crypto/Makefile
+++ b/crypto/Makefile
@@ -2,6 +2,8 @@
 # Cryptographic API
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-$(CONFIG_CRYPTO) += crypto.o
 crypto-y := api.o cipher.o compress.o
 
diff --git a/drivers/char/Makefile b/drivers/char/Makefile
index 1c66cc0..2bf4664 100644
--- a/drivers/char/Makefile
+++ b/drivers/char/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the kernel character device drivers.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-y				+= mem.o random.o
 obj-$(CONFIG_TTY_PRINTK)	+= ttyprintk.o
 obj-y				+= misc.o
diff --git a/drivers/clocksource/Makefile b/drivers/clocksource/Makefile
index 8d81a1d..17532d8 100644
--- a/drivers/clocksource/Makefile
+++ b/drivers/clocksource/Makefile
@@ -1,3 +1,5 @@
+KBUILD_CFLAGS	+=-O3
+
 obj-$(CONFIG_ATMEL_TCB_CLKSRC)	+= tcb_clksrc.o
 obj-$(CONFIG_X86_CYCLONE_TIMER)	+= cyclone.o
 obj-$(CONFIG_X86_PM_TIMER)	+= acpi_pm.o
diff --git a/drivers/cpufreq/Makefile b/drivers/cpufreq/Makefile
index 7dbb0f9..5dc0864 100644
--- a/drivers/cpufreq/Makefile
+++ b/drivers/cpufreq/Makefile
@@ -1,3 +1,5 @@
+KBUILD_CFLAGS	+=-O3
+
 # CPUfreq core
 obj-$(CONFIG_CPU_FREQ)			+= cpufreq.o
 # CPUfreq stats
diff --git a/drivers/cpuidle/Makefile b/drivers/cpuidle/Makefile
index 38c8f69..62fc2ba 100644
--- a/drivers/cpuidle/Makefile
+++ b/drivers/cpuidle/Makefile
@@ -2,5 +2,7 @@
 # Makefile for cpuidle.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-y += cpuidle.o driver.o governor.o sysfs.o governors/
 obj-$(CONFIG_ARCH_NEEDS_CPU_IDLE_COUPLED) += coupled.o
diff --git a/drivers/i2c/Makefile b/drivers/i2c/Makefile
index 002558a..6244a4b 100644
--- a/drivers/i2c/Makefile
+++ b/drivers/i2c/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the i2c core.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-$(CONFIG_I2C_BOARDINFO)	+= i2c-boardinfo.o
 obj-$(CONFIG_I2C)		+= i2c-core.o
 obj-$(CONFIG_I2C_SMBUS)		+= i2c-smbus.o
diff --git a/drivers/input/Makefile b/drivers/input/Makefile
index cf643be..500570c 100644
--- a/drivers/input/Makefile
+++ b/drivers/input/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the input core drivers.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 # Each configuration option enables a list of files.
 
 obj-$(CONFIG_INPUT)		+= input-core.o
diff --git a/drivers/staging/Makefile b/drivers/staging/Makefile
index 7fcd2d6..584f3cc 100755
--- a/drivers/staging/Makefile
+++ b/drivers/staging/Makefile
@@ -1,5 +1,7 @@
 # Makefile for staging directory
 
+KBUILD_CFLAGS	+=-O3
+
 # fix for build system bug...
 obj-$(CONFIG_STAGING)		+= staging.o
 
diff --git a/drivers/thermal/Kconfig b/drivers/thermal/Kconfig
index 19a1783..ee9734d 100644
--- a/drivers/thermal/Kconfig
+++ b/drivers/thermal/Kconfig
@@ -77,7 +77,6 @@ config THERMAL_MONITOR
 	bool "Monitor thermal state and limit CPU Frequency"
 	depends on THERMAL_TSENS8960 || THERMAL_TSENS8974
 	depends on CPU_FREQ_MSM
-	default n
 	help
 	  This enables thermal monitoring capability in the kernel in the
 	  absence of a system wide thermal monitoring entity or until such an
diff --git a/drivers/tty/Makefile b/drivers/tty/Makefile
index 71f6a99..943be09 100644
--- a/drivers/tty/Makefile
+++ b/drivers/tty/Makefile
@@ -1,3 +1,5 @@
+KBUILD_CFLAGS	+=-O3
+
 obj-y				+= tty_io.o n_tty.o tty_ioctl.o tty_ldisc.o \
 				   tty_buffer.o tty_port.o tty_mutex.o
 obj-$(CONFIG_LEGACY_PTYS)	+= pty.o
diff --git a/drivers/watchdog/Makefile b/drivers/watchdog/Makefile
index e8f479a..4172da3 100644
--- a/drivers/watchdog/Makefile
+++ b/drivers/watchdog/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the WatchDog device drivers.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 # The WatchDog Timer Driver Core.
 watchdog-objs	+= watchdog_core.o watchdog_dev.o
 obj-$(CONFIG_WATCHDOG_CORE)	+= watchdog.o
diff --git a/firmware/Makefile b/firmware/Makefile
index 0d15a3d..008e0a5 100644
--- a/firmware/Makefile
+++ b/firmware/Makefile
@@ -2,6 +2,8 @@
 # kbuild file for firmware/
 #
 
+KBUILD_CFLAGS	+=-O3
+
 # Create $(fwabs) from $(CONFIG_EXTRA_FIRMWARE_DIR) -- if it doesn't have a
 # leading /, it's relative to $(srctree).
 fwdir := $(subst ",,$(CONFIG_EXTRA_FIRMWARE_DIR))
diff --git a/fs/Makefile b/fs/Makefile
index 11dfbf1..5c60ceb 100644
--- a/fs/Makefile
+++ b/fs/Makefile
@@ -5,6 +5,8 @@
 # Rewritten to use lists instead of if-statements.
 # 
 
+KBUILD_CFLAGS	+=-O3
+
 obj-y :=	open.o read_write.o file_table.o super.o \
 		char_dev.o stat.o exec.o pipe.o namei.o fcntl.o \
 		ioctl.o readdir.o select.o fifo.o dcache.o inode.o \
diff --git a/init/Makefile b/init/Makefile
index 0bf677a..88aa4e0 100644
--- a/init/Makefile
+++ b/init/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the linux kernel.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-y                          := main.o version.o mounts.o
 ifneq ($(CONFIG_BLK_DEV_INITRD),y)
 obj-y                          += noinitramfs.o
diff --git a/ipc/Makefile b/ipc/Makefile
index 9075e17..3a70c3b 100644
--- a/ipc/Makefile
+++ b/ipc/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the linux ipc.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-$(CONFIG_SYSVIPC_COMPAT) += compat.o
 obj-$(CONFIG_SYSVIPC) += util.o msgutil.o msg.o sem.o shm.o ipcns_notifier.o syscall.o
 obj-$(CONFIG_SYSVIPC_SYSCTL) += ipc_sysctl.o
diff --git a/lib/Makefile b/lib/Makefile
index c5f2b3b..fcc7366 100644
--- a/lib/Makefile
+++ b/lib/Makefile
@@ -2,6 +2,8 @@
 # Makefile for some libs needed in the kernel.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 ifdef CONFIG_FUNCTION_TRACER
 ORIG_CFLAGS := $(KBUILD_CFLAGS)
 KBUILD_CFLAGS = $(subst -pg,,$(ORIG_CFLAGS))
diff --git a/mm/Makefile b/mm/Makefile
index ccecbf9..9a1ffd5 100644
--- a/mm/Makefile
+++ b/mm/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the linux memory manager.
 #
 
+KBUILD_CFLAGS	+=-O3
+
 mmu-y			:= nommu.o
 mmu-$(CONFIG_MMU)	:= fremap.o highmem.o madvise.o memory.o mincore.o \
 			   mlock.o mmap.o mprotect.o mremap.o msync.o rmap.o \
diff --git a/samples/Makefile b/samples/Makefile
index 2f75851..2003a3a 100644
--- a/samples/Makefile
+++ b/samples/Makefile
@@ -1,4 +1,6 @@
 # Makefile for Linux samples code
 
+KBUILD_CFLAGS	+=-O3
+
 obj-$(CONFIG_SAMPLES)	+= kobject/ kprobes/ tracepoints/ trace_events/ \
 			   hw_breakpoint/ kfifo/ kdb/ hidraw/ rpmsg/
diff --git a/scripts/Makefile b/scripts/Makefile
index 3626666..33680f5 100644
--- a/scripts/Makefile
+++ b/scripts/Makefile
@@ -10,6 +10,8 @@
 
 HOST_EXTRACFLAGS += -I$(srctree)/tools/include
 
+KBUILD_CFLAGS	+=-O3
+
 hostprogs-$(CONFIG_KALLSYMS)     += kallsyms
 hostprogs-$(CONFIG_LOGO)         += pnmtologo
 hostprogs-$(CONFIG_VT)           += conmakehash
diff --git a/security/Makefile b/security/Makefile
index a38e6db..076626b 100644
--- a/security/Makefile
+++ b/security/Makefile
@@ -2,6 +2,8 @@
 # Makefile for the kernel security code
 #
 
+KBUILD_CFLAGS	+=-O3
+
 obj-$(CONFIG_KEYS)			+= keys/
 subdir-$(CONFIG_SECURITY_SELINUX)	+= selinux
 subdir-$(CONFIG_SECURITY_SMACK)		+= smack
diff --git a/usr/Makefile b/usr/Makefile
index 029ffe6..0097a29 100644
--- a/usr/Makefile
+++ b/usr/Makefile
@@ -2,6 +2,8 @@
 # kbuild file for usr/ - including initramfs image
 #
 
+KBUILD_CFLAGS	+=-O3
+
 klibcdirs:;
 PHONY += klibcdirs
 
