--- drivers/cpufreq/cpufreq_nightmare.c
+++ drivers/cpufreq/cpufreq_nightmare.c
@@ -396,7 +396,7 @@ static ssize_t store_io_is_busy(struct kobject *a, struct attribute *b,
 	nightmare_tuners_ins.io_is_busy = !!input;
 
 	/* we need to re-evaluate prev_cpu_idle */
-	get_online_cpus();
+	cpu_maps_update_begin();
 	for_each_online_cpu(cpu) {
 		struct cpufreq_nightmare_cpuinfo *this_nightmare_cpuinfo = 
 			&per_cpu(od_nightmare_cpuinfo, cpu);
@@ -404,7 +404,7 @@ static ssize_t store_io_is_busy(struct kobject *a, struct attribute *b,
 		this_nightmare_cpuinfo->prev_cpu_idle = get_cpu_idle_time(cpu,
 			&this_nightmare_cpuinfo->prev_cpu_wall, nightmare_tuners_ins.io_is_busy);
 	}
-	put_online_cpus();
+	cpu_maps_update_done();
 	return count;
 }
 
